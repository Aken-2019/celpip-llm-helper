{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container mt-4">
    <h2>Your API Key</h2>



    <div class="card mt-4">
        <div class="card-body">
            {% if has_api_key %}
                <h5 class="card-title">Your API Key</h5>
                <div class="input-group mb-3">
                    <input type="text" 
                           class="form-control" 
                           value="{{ api_key.key }}" 
                           id="apiKey" 
                           readonly>
                    <button class="btn btn-outline-secondary" 
                            type="button" 
                            onclick="copyToClipboard()">
                        Copy
                    </button>
                </div>
                <p class="text-muted">
                    <small>
                        Created: {{ api_key.created_at|date:"M d, Y H:i" }}<br>
                        {% if api_key.expired_at %}
                            Expires: {{ api_key.expired_at|date:"M d, Y H:i" }}
                        {% endif %}
                    </small>
                </p>
                <div class="mt-3">
                    <a href="{% url 'api2d:api-key-delete' %}" class="btn btn-outline-danger">
                        <i class="bi bi-trash me-1"></i> Delete API Key
                    </a>
                </div>
            {% else %}
                <h5 class="card-title">Add New API Key</h5>
                <form method="post" action="{% url 'api2d:api-key' %}">
                    {% csrf_token %}
                    {{ form|crispy }}
                    <div class="form-text mb-3">
                        Enter your API key to link it to your account.
                    </div>
                    <button type="submit" class="btn btn-primary">Save API Key</button>
                </form>
            {% endif %}
        </div>
    </div>
</div>

<script>
function copyToClipboard() {
    const copyText = document.getElementById("apiKey");
    copyText.select();
    copyText.setSelectionRange(0, 99999); // For mobile devices
    document.execCommand("copy");
    
    // Optional: Show a tooltip or change the button text
    const button = event.target;
    const originalText = button.textContent;
    button.textContent = "Copied!";
    setTimeout(() => {
        button.textContent = originalText;
    }, 2000);
}
</script>
{% endblock %}